<h2 mat-dialog-title>Reporte de Stock</h2>
<mat-dialog-content>
  <div>
    <div>
      <form [formGroup]="formStock" autocomplete="off">
        <div class="w-full">
          <div class="col-span-1 overflow-visible py-2">
            <mat-form-field class="w-full" appearance="outline">
              <mat-label>Buscar por CÓDIGO o DESCRIPCIÓN</mat-label>
              <input
                type="search"
                matInput
                formControlName="producto"
                placeholder="Buscar por CÓDIGO o DESCRIPCIÓN"
                (keyup)="cargarInput()"
              />
              <mat-icon matPrefix>search</mat-icon>
            </mat-form-field>
          </div>
        </div>
      </form>

      <div class="row">
        <div
          class="w-full gap-2 flex flex-col md:px-2"
          *ngIf="!!listStockLocal() && listStockLocal().length > 0"
        >
          <mat-card
            appearance="raised"
            class="!bg-white !p-0 !overflow-hidden"
            *ngFor="let item of listStockLocal()"
          >
            <div
              class="flex flex-row gap-2 md:gap-4 justify-center items-stretch"
            >
              <div
                class="px-2 py-4 md:px-4 md:py-6 flex-1 flex flex-col md:flex-row gap-4 overflow-hidden"
              >
                <div class="flex flex-col md:flex-1">
                  <p
                    class="poppins-regular text-xs w-fit border-b-neutral-500 border-0 border-b border-solid"
                    matBadge="4"
                    matBadgeOverlap="false"
                  >
                    <b>{{ item.codProducto }}</b>
                    -
                    {{ item.nombProducto }}
                    <br />
                  </p>
                  <div class="flex flex-row flex-wrap w-full justify-evenly">
                    <div
                      class="flex flex-row flex-wrap gap-2 justify-between flex-1 p-2"
                    >
                      <div class="flex flex-col">
                        <label class="text-xs poppins-semibold">Stock</label>
                        <span class="text-xs">{{ item.stock }}</span>
                      </div>
                      <div class="flex flex-col">
                        <label class="text-xs poppins-semibold"
                          >Reservado</label
                        >
                        <span class="text-xs">{{ -item.reservado }}</span>
                      </div>
                      <div class="flex flex-col">
                        <label class="text-xs poppins-semibold"
                          >En pedido</label
                        >
                        <span class="text-xs">{{ item.enLista }}</span>
                      </div>
                      <div class="flex flex-col">
                        <label class="text-xs poppins-semibold"
                          >Disponible</label
                        >
                        <span class="text-xs">{{ item.disponible }}</span>
                      </div>
                    </div>
                    <div
                      class="grid grid-cols-2 gap-2 max-w-full md:max-w-xs w-full border-solid border border-neutral-300 p-2 rounded-lg"
                    >
                      <div class="w-full flex flex-row flex-wrap gap-2">
                        <div class="poppins-regular flex flex-col">
                          <label class="text-xs"><b>Precio</b></label>

                          <div
                            type="text"
                            class="h-8 border-neutral-300 border text-xs w-full flex items-center rounded-lg"
                            [ngClass]="{'bg-neutral-200': !item.precioEditable}"
                          >
                            <label
                              [for]="'precio' + item.codProducto"
                              class="pl-2 py-2"
                              >S/.</label
                            >
                            <input
                              [id]="'precio' + item.codProducto"
                              type="number"
                              [disabled]="!item.precioEditable"
                              [value]="item.precio"
                              [ngStyle]="{
                                width:
                                  (item.precio.toString().length || 0) +
                                  2 +
                                  'ch'
                              }"
                              class="h-full !bg-transparent !border-0 !outline-none"
                              (input)="cambiarPrecio(item, $event)"
                            />
                            <!-- {{ item.precio | number : "1.2-2" }} -->
                          </div>
                        </div>
                        <!-- <p
                          class="poppins-regular flex flex-col"
                          *ngIf="item.usaImpuesto"
                        >
                          <label class="text-xs"><b>IGV</b></label>
                          <span
                            type="text"
                            class="h-8 py-2 border text-xs w-full flex items-center rounded-full"
                          >
                            {{ item.impuesto | number : "1.2-2" }}%</span
                          >
                        </p> -->
                      </div>
                      <div class="w-full">
                        <div
                          class="w-full flex flex-col poppins-regular text-xs items-center"
                        >
                          <label class="text-xs"><b>Cantidad</b></label>
                          <div
                            class="border-neutral-300 px-1 py-2 border text-xs w-full flex flex-row overflow-hidden h-8 items-center justify-center content-center rounded-full"
                          >
                            <button
                              class="h-7 border-none outline-non m-0 flex items-center justify-center rounded-full bg-neutral-100 text-neutral-500 p-1"
                              (click)="cambiarCantidad(item, -1)"
                              [disabled]="item.reservando_local == 0"
                            >
                              <mat-icon>remove</mat-icon>
                            </button>
                            <input
                              matInput
                              type="number"
                              id="cnt{{ item.codProducto }}"
                              value="{{ item.reservando_local }}"
                              class="px-2 py-0 m-0 leading-none text-xs text-center bg-transparent border-none outline-none flex-1"
                              min="1"
                              style="width: 4ch"
                              pattern="^[0-9]+"
                              (change)="cambiarCantidad(item, 0, $event)"
                            />
                            <button
                              class="h-7 border-none outline-non m-0 flex items-center justify-center rounded-full bg-neutral-100 text-neutral-500 p-1"
                              (click)="cambiarCantidad(item, 1)"
                            >
                              <mat-icon>add</mat-icon>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div
                class="flex bg-green-500 px-2 md:px-8 items-center justify-center cursor-pointer"
                (click)="agregarProducto(item, item.reservando_local)"
              >
                <mat-icon class="text-white">add</mat-icon>
              </div>
            </div>
          </mat-card>
        </div>
      </div>
      <div class="row mt-2" *ngIf="listStockLocal().length > 0">
        <div class="col">
          <div
            class="flex flex-col md:flex-row md:justify-between md:items-center gap-2"
          >
            <span class="poppins-regular text-sm"
              >Total Registros: {{ totalRecords }}</span
            >
            <mat-paginator
              #paginator
              (page)="handlePageChange($event)"
              [length]="totalRecords"
              [pageSize]="pageSize"
              [pageSizeOptions]="[10, 20, 50, 100]"
              [pageIndex]="paginatorIndex"
            >
            </mat-paginator>
          </div>
        </div>
      </div>
      <div class="p-3" *ngIf="listStockLocal().length == 0">
        <div>
          <p class="poppins-regular">
            No se encontraron registros para mostrar
          </p>
        </div>
      </div>
    </div>
  </div>
</mat-dialog-content>
<mat-dialog-actions>
  <button
    mat-button
    type="button"
    id="limpiarModal"
    data-bs-dismiss="modal"
    (click)="limpiarForm()"
  >
    <mat-icon>brush</mat-icon> Limpiar
  </button>

  <button
    mat-button
    type="button"
    id="cerrarModal"
    data-bs-dismiss="modal"
    (click)="onNoClick()"
  >
    <mat-icon>close</mat-icon> Cerrar
  </button>
</mat-dialog-actions>
