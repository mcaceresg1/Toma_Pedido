<mat-sidenav-container class="w-screen h-screen overflow-hidden">
  <mat-sidenav
    #sidenav
    [mode]="isSmallScreen ? 'over' : 'side'"
    [(opened)]="opened"
    class="!max-w-56 !p-0 !px-0"
    style="background-color: #190627"
  >
    <nav class="w-full h-full flex flex-col">
      <!-- Logo del sidebar -->
      <div class="sidebar-logo">
        <img
          class="logo-image"
          src="/assets/images/Logo_nexwork_ERP_WHITE.png"
          alt="Nexwork ERP"
          (click)="navegarA('/home')"
          title="Ir al Home"
        />
        <button
          mat-icon-button
          (click)="toggleDrawer()"
          class="menu-toggle-btn"
        >
          <mat-icon>{{ opened ? "arrow_back" : "menu" }}</mat-icon>
        </button>
      </div>

      <nav class="sidebar-nav">
        <ul class="menu-list">
          <!-- INICIO -->
          <li class="menu-item" *ngIf="getPermisos('Ventas')">
            <a class="menu-item-content" [routerLink]="['/home']" routerLinkActive="active">
              <mat-icon class="menu-icon">home</mat-icon>
              <span class="menu-text">Home</span>
            </a>
          </li>

          <!-- VENTAS CON SUBMENÚ -->
          <li class="menu-item has-submenu" [class.expanded]="ventasExpanded" *ngIf="getPermisos('Ventas')">
            <div class="menu-item-content" (click)="toggleVentas()">
              <mat-icon class="menu-icon">real_estate_agent</mat-icon>
              <span class="menu-text">Ventas</span>
              <mat-icon class="expand-icon">{{ ventasExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
            </div>
            <ul class="submenu-list" *ngIf="ventasExpanded">
              <li class="menu-item">
                <a class="menu-item-content submenu-item" (click)="navegarA('/dashboard/pages/addpedido')">
                  <mat-icon class="menu-icon">add_shopping_cart</mat-icon>
                  <span class="menu-text">Registro Pedido</span>
                </a>
              </li>
            </ul>
          </li>

          <!-- REPORTE VENTAS CON SUBMENÚ -->
          <li class="menu-item has-submenu" [class.expanded]="reporteVentasExpanded" *ngIf="getPermisos('Ventas')">
            <div class="menu-item-content" (click)="toggleReporteVentas()">
              <mat-icon class="menu-icon">assessment</mat-icon>
              <span class="menu-text">Reporte Ventas</span>
              <mat-icon class="expand-icon">{{ reporteVentasExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
            </div>
            <ul class="submenu-list" *ngIf="reporteVentasExpanded">
              <li class="menu-item">
                <a class="menu-item-content submenu-item" (click)="navegarA('/dashboard/pages/ordenPedidos')">
                  <mat-icon class="menu-icon">person</mat-icon>
                  <span class="menu-text">Pedidos x Vend.</span>
                </a>
              </li>
              <li class="menu-item">
                <a class="menu-item-content submenu-item" (click)="navegarA('/dashboard/pages/ordenPedidosZona')">
                  <mat-icon class="menu-icon">location_on</mat-icon>
                  <span class="menu-text">Pedidos x Zona</span>
                </a>
              </li>
            </ul>
          </li>

          <!-- REPORTE COMPRAS -->
          <li class="menu-item has-submenu" [class.expanded]="reporteComprasExpanded" *ngIf="getPermisos('Reportes')">
            <div class="menu-item-content" (click)="toggleReporteCompras()">
              <mat-icon class="menu-icon">bar_chart</mat-icon>
              <span class="menu-text">Reporte Compras</span>
              <mat-icon class="expand-icon">{{ reporteComprasExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
            </div>
            <ul class="submenu-list" *ngIf="reporteComprasExpanded">
              <li class="menu-item">
                <a class="menu-item-content submenu-item" [routerLink]="['/dashboard/pages/reporteProductos']" routerLinkActive="active">
                  <mat-icon class="menu-icon">inventory</mat-icon>
                  <span class="menu-text">Productos</span>
                </a>
              </li>
              <li class="menu-item">
                <a class="menu-item-content submenu-item" [routerLink]="['/dashboard/pages/reporteProveedor']" routerLinkActive="active">
                  <mat-icon class="menu-icon">local_shipping</mat-icon>
                  <span class="menu-text">Proveedores</span>
                </a>
              </li>
            </ul>
          </li>

          <!-- MANTENIMIENTO CON SUBMENÚ -->
          <li class="menu-item has-submenu" [class.expanded]="mantenimientoExpanded" *ngIf="getPermisos('Mantenimiento')">
            <div class="menu-item-content" (click)="toggleMantenimiento()">
              <mat-icon class="menu-icon">settings</mat-icon>
              <span class="menu-text">Mantenimiento</span>
              <mat-icon class="expand-icon">{{ mantenimientoExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
            </div>
            <ul class="submenu-list" *ngIf="mantenimientoExpanded">
              <li class="menu-item">
                <a class="menu-item-content submenu-item" (click)="navegarA('/dashboard/pages/gestion-zonas')">
                  <mat-icon class="menu-icon">map</mat-icon>
                  <span class="menu-text">Zonas</span>
                </a>
              </li>
              <li class="menu-item">
                <a class="menu-item-content submenu-item" (click)="navegarA('/dashboard/pages/ubigeos-por-zona')">
                  <mat-icon class="menu-icon">place</mat-icon>
                  <span class="menu-text">Ubigeos x Zona</span>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      
      <!-- Footer del sidebar -->
      <div class="sidebar-footer">
        <div class="connection-info">
          <span class="connection-label">Conexión:</span>
          <span class="connection-value">{{ connectionDetails() }}</span>
        </div>
        <div class="copyright">
          <div class="copyright-text">Copyright © Nexwork ERP</div>
        </div>
      </div>
    </nav>
  </mat-sidenav>

  <mat-sidenav-content class="!bg-white">
    <section class="w-full h-full flex flex-col">
      <mat-toolbar class="shadow z-50">
        <button
          [hidden]="opened"
          mat-icon-button
          (click)="toggleDrawer()"
          class="text-xl"
        >
          <mat-icon>{{ opened ? "close" : "menu" }}</mat-icon>
        </button>
        <div class="flex-1"></div>
        <div>
          <button
            mat-button
            [matMenuTriggerFor]="options"
            class="!h-12 !relative !w-fit !p-0 !px-2"
          >
            <div class="flex flex-row items-center justify-center gap-2">
              <div class="flex flex-col justify-start items-start">
                <span class="leading-none font-semibold">Usuario</span>
                <span class="leading-none">{{ usuario()?.alias }}</span>
              </div>
              <div
                class="top-0 left-0 !w-10 !aspect-square object-cover rounded-full overflow-hidden"
              >
                <img
                  class="w-full h-full object-contain"
                  [src]="logoEmpresa()"
                />
              </div>
              <div class="flex flex-col justify-start items-start">
                <span class="ml-2 text-sm">{{ usuario()?.nombreUsuario }}</span>
                <span class="ml-2 text-xs">{{ empresa()?.nombre }}</span>
              </div>
              <mat-icon>arrow_drop_down</mat-icon>
            </div>
          </button>

          <mat-menu #options>
            <button
              mat-menu-item
              *ngFor="let item of userEmpresas()"
              (click)="cambiarEmpresa(item.codigo)"
            >
              <mat-icon>
                <div
                  class="top-0 left-0 !w-full !aspect-square object-cover rounded-full overflow-hidden"
                >
                  <img class="w-full h-full object-contain" [src]="item.logo" />
                </div>
              </mat-icon>
              {{ item.nombre }}
            </button>
            <button mat-menu-item (click)="logout()">
              <mat-icon>logout</mat-icon>Cerrar Sesión
            </button>
          </mat-menu>
        </div>
      </mat-toolbar>

      <div class="overflow-hidden w-full flex-1">
        <div class="w-full h-full overflow-x-hidden overflow-y-auto">
          <router-outlet></router-outlet>
        </div>
      </div>
    </section>
  </mat-sidenav-content>
</mat-sidenav-container>
<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#fff"
  type="ball-scale-multiple"
  name="usuario"
>
  <p style="font-size: 20px; color: white">
    Cargando información del usuario...
  </p>
</ngx-spinner>
<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#fff"
  type="ball-scale-multiple"
  name="empresa"
>
  <p style="font-size: 20px; color: white">
    Cargando información de la empresa...
  </p>
</ngx-spinner>
<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#fff"
  type="ball-scale-multiple"
  name="empresas"
>
  <p style="font-size: 20px; color: white">Cargando lista de empresas...</p>
</ngx-spinner>
